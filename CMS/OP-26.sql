SELECT 
	A.PtNo_Num                          AS [Visit ID]
	, CONVERT(VARCHAR, A.Adm_Date, 110) AS [Admit Date]
	, B.ClasfCd                         AS [Procedure Code]
	, COND.Condition                    AS [Condition]

FROM smsdss.BMH_PLM_PtAcct_V					A
	JOIN smsdss.BMH_PLM_PtAcct_Clasf_Proc_V_New B
	ON A.Pt_No = B.Pt_No

CROSS APPLY (
SELECT
	CASE
		WHEN B.ClasfCd IN (
		'36147', '36870', '36821', '36832', '36830', '93545', '93459',
		'93460', '35475', '36561', '36569', '36558', '36581', '93620',
		'33208', '33228', '93312', 'C8929'
		)
		THEN 'Cardiovascular'
		WHEN B.ClasfCd IN (
		'66982', '66984', '66821', '67028'
		)
		THEN 'Eye'
		WHEN B.ClasfCd IN (
		'47000', '43239', '45380', 'G0105', '45381', '45384', '43450',
		'43259', '43249', '43248', '43760', '47562', '49083', '49505'
		)
		THEN 'Gastrointestinal'
		WHEN B.ClasfCd IN (
		'52000', '52332', '52353', '58558', '51720', '50590'
		)
		THEN 'Genitourinary'
		WHEN B.ClasfCd IN (
		'29125', '29580', '29581', '29826', '29881', '29827', '29880',
		'38221', '26055', '20610', '20605', 'G0364', '20552', '28285'
		)
		THEN 'Musculoskeletal'
		WHEN B.ClasfCd IN (
		'62311', '62270', '64493', '64494', '64484', 'G0260', '64636',
		'62310', '64495', '64635', '95886', '64721'
		)
		THEN 'Nervous'
		WHEN B.ClasfCd IN (
		'31624', '62405', '31575'
		)
		THEN 'Respiratory'
		WHEN B.ClasfCd IN (
		'11042', '17003', '97597', '11045', '12001', '17000', '10022',
		'12002', '11721', '11100', '97597', '97598', '12011', '97605',
		'10060', '97602', '11043', '15271', '17110', '15275', '12013',
		'17311', '17250', '11101'
		)
		THEN 'Skin'
		WHEN B.ClasfCd IN (
		'90870', '38525', '19301', 'G0340'
		)
		THEN 'Other'
	END AS Condition
) COND
		
WHERE A.vst_start_dtime >= '2013-01-01'
	AND A.vst_start_dtime < '2014-01-01'
	AND (
		LEFT(A.PtNo_Num, 1) = '6'
		OR 
		LEFT(A.PtNo_Num, 1) = '3'
		)
	AND B.ClasfCd IN (
	'36147', '36870', '36821', '36832', '36830', '93545', '93459', '93460',
	'35475', '36561', '36569', '36558', '36581', '93620', '33208', '33228',
	'93312', 'C8929', '66982', '66984', '66821', '67028', '47000', '43239',
	'45380', 'G0105', '45381', '45384', '43450', '43259', '43249', '43248',
	'43760', '47562', '49083', '49505', '52000', '52332', '52353', '58558',
	'51720', '50590', '29125', '29580', '29581', '29826', '29881', '29827',
	'29880', '38221', '26055', '20610', '20605', 'G0364', '20552', '28285',
	'62311', '62270', '64493', '64494', '64484', 'G0260', '64636', '62310',
	'64495', '64635', '95886', '64721', '31624', '62405', '31575', '11042',
	'17003', '97597', '11045', '12001', '17000', '10022', '12002', '11721',
	'11100', '97597', '97598', '12011', '97605', '10060', '97602', '11043',
	'15271', '17110', '15275', '12013', '17311', '17250', '11101', '90870',
	'38525', '19301', 'G0340'
)
SELECT A.PT_NO
, CAST(B.Adm_Date AS DATE)          AS ADM_DATE
, DATEPART(YEAR, Adm_Date)          AS ADM_YEAR
, DATEPART(MONTH, ADM_DATE)         AS ADM_MONTH
, CAST(B.Dsch_Date AS DATE)         AS DSCH_DATE
, DATEPART(YEAR, DSCH_DATE)         AS DSCH_YEAR
, DATEPART(MONTH, DSCH_DATE)        AS DSCH_MONTH
, CAST(B.Days_Stay AS INT)          AS LOS
, B.Atn_Dr_No
, C.pract_rpt_name
, A.Clasf_Eff_Date
, DATEPART(MONTH, A.Clasf_Eff_Date) AS SVC_MONTH
, DATEPART(YEAR, A.CLASF_EFF_DATE)  AS SVC_YEAR
, A.CLASFCD
, D.alt_clasf_desc

FROM SMSDSS.BMH_PLM_PtAcct_Clasf_Proc_V_New AS A
LEFT JOIN SMSDSS.BMH_PLM_PTACCT_V           AS B
ON A.Pt_No = B.Pt_No
LEFT JOIN SMSDSS.pract_dim_v                AS C
ON A.RespParty = C.src_pract_no
       AND B.Regn_Hosp = C.orgz_cd
LEFT JOIN SMSDSS.proc_dim_v                 AS D
ON A.ClasfCd = D.proc_cd
	AND A.Proc_Cd_Schm = D.proc_cd_schm

WHERE B.Dsch_Date >= '2015-01-01'
AND B.Dsch_Date < '2016-11-01'
AND A.ClasfCd IN (
       '33202','33203','33206','33207','33208','33210','33211',
       '33212','33213','33221','33216','33217','33224','33225',
       '93583',
	   -- icd-10
	   '0JH604A','0JH605Z','0JH606Z','0JH607Z',
	   '0JH634Z','0JH635Z','0JH636Z','0JH637Z',
	   '0JH804Z','0JH805Z','0JH806Z','0JH807Z',
	   '0JH834Z','0JH835Z','0JH836Z','0JH837Z',
	   '02H60JZ','02H60KZ','02H60MZ','02H60NZ',
	   '02H63JZ','02H63KZ','02H63MZ','02H63NZ',
	   '02H64JZ','02H64KZ','02H64MZ','02H64NZ',
	   '02H70JZ','02H70KZ','02H70MZ','02H70NZ',
	   '02H73JZ','02H73KZ','02H73MZ','02H73NZ',
	   '02H74JZ','02H74KZ','02H74MZ','02H74NZ',
	   '02HK0JZ','02HK0KZ','02HK0MZ','02HK0NZ',
	   '02HK3JZ','02HK3KZ','02HK3MZ','02HK3NZ',
	   '02HK4JZ','02HK4KZ','02HK4MZ','02HK4NZ',
	   '02HL0JZ','02HL0KZ','02HL0MZ','02HL0NZ',
	   '02HL3JZ','02HL3KZ','02HL3MZ','02HL3NZ',
	   '02HL4JZ','02HL4KZ','02HL4MZ','02HL4NZ',
	   '0JH80ZZ','0JH83ZZ','0JH60ZZ','0JH63ZZ'
)

ORDER BY a.Pt_No
OPTION(FORCE ORDER);
